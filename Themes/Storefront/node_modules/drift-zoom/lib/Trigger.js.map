{"version":3,"sources":["../src/js/Trigger.js"],"names":["Trigger","options","_show","bind","_hide","_handleEntry","_handleMovement","el","zoomPane","sourceAttribute","handleTouch","onShow","onHide","hoverDelay","touchDelay","hoverBoundingBox","touchBoundingBox","namespace","zoomFactor","boundingBoxContainer","settings","boundingBox","containerEl","enabled","_bindEvents","addEventListener","removeEventListener","e","preventDefault","_lastMovement","type","entryTimeout","setTimeout","show","getAttribute","clientWidth","clientHeight","touchActivated","touches","clearTimeout","hide","movementX","movementY","firstTouch","clientX","clientY","rect","getBoundingClientRect","offsetX","left","offsetY","top","percentageOffsetX","percentageOffsetY","setPosition","isShowing"],"mappings":"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","sourcesContent":["import throwIfMissing from \"./util/throwIfMissing\";\nimport BoundingBox from \"./BoundingBox\";\n\nexport default class Trigger {\n  constructor(options = {}) {\n    this._show = this._show.bind(this);\n    this._hide = this._hide.bind(this);\n    this._handleEntry = this._handleEntry.bind(this);\n    this._handleMovement = this._handleMovement.bind(this);\n\n    let {\n      el = throwIfMissing(),\n      zoomPane = throwIfMissing(),\n      sourceAttribute = throwIfMissing(),\n      handleTouch = throwIfMissing(),\n      onShow = null,\n      onHide = null,\n      hoverDelay = 0,\n      touchDelay = 0,\n      hoverBoundingBox = throwIfMissing(),\n      touchBoundingBox = throwIfMissing(),\n      namespace = null,\n      zoomFactor = throwIfMissing(),\n      boundingBoxContainer = throwIfMissing()\n    } = options;\n\n    this.settings = {\n      el,\n      zoomPane,\n      sourceAttribute,\n      handleTouch,\n      onShow,\n      onHide,\n      hoverDelay,\n      touchDelay,\n      hoverBoundingBox,\n      touchBoundingBox,\n      namespace,\n      zoomFactor,\n      boundingBoxContainer\n    };\n\n    if (this.settings.hoverBoundingBox || this.settings.touchBoundingBox) {\n      this.boundingBox = new BoundingBox({\n        namespace: this.settings.namespace,\n        zoomFactor: this.settings.zoomFactor,\n        containerEl: this.settings.boundingBoxContainer\n      });\n    }\n\n    this.enabled = true;\n\n    this._bindEvents();\n  }\n\n  get isShowing() {\n    return this.settings.zoomPane.isShowing;\n  }\n\n  _bindEvents() {\n    this.settings.el.addEventListener(\"mouseenter\", this._handleEntry, false);\n    this.settings.el.addEventListener(\"mouseleave\", this._hide, false);\n    this.settings.el.addEventListener(\"mousemove\", this._handleMovement, false);\n\n    if (this.settings.handleTouch) {\n      this.settings.el.addEventListener(\"touchstart\", this._handleEntry, false);\n      this.settings.el.addEventListener(\"touchend\", this._hide, false);\n      this.settings.el.addEventListener(\"touchmove\", this._handleMovement, false);\n    }\n  }\n\n  _unbindEvents() {\n    this.settings.el.removeEventListener(\"mouseenter\", this._handleEntry, false);\n    this.settings.el.removeEventListener(\"mouseleave\", this._hide, false);\n    this.settings.el.removeEventListener(\"mousemove\", this._handleMovement, false);\n\n    if (this.settings.handleTouch) {\n      this.settings.el.removeEventListener(\"touchstart\", this._handleEntry, false);\n      this.settings.el.removeEventListener(\"touchend\", this._hide, false);\n      this.settings.el.removeEventListener(\"touchmove\", this._handleMovement, false);\n    }\n  }\n\n  _handleEntry(e) {\n    e.preventDefault();\n    this._lastMovement = e;\n\n    if (e.type == \"mouseenter\" && this.settings.hoverDelay) {\n      this.entryTimeout = setTimeout(this._show, this.settings.hoverDelay);\n    } else if (this.settings.touchDelay) {\n      this.entryTimeout = setTimeout(this._show, this.settings.touchDelay);\n    } else {\n      this._show();\n    }\n  }\n\n  _show() {\n    if (!this.enabled) {\n      return;\n    }\n\n    let onShow = this.settings.onShow;\n    if (onShow && typeof onShow === \"function\") {\n      onShow();\n    }\n\n    this.settings.zoomPane.show(\n      this.settings.el.getAttribute(this.settings.sourceAttribute),\n      this.settings.el.clientWidth,\n      this.settings.el.clientHeight\n    );\n\n    if (this._lastMovement) {\n      let touchActivated = this._lastMovement.touches;\n      if ((touchActivated && this.settings.touchBoundingBox) || (!touchActivated && this.settings.hoverBoundingBox)) {\n        this.boundingBox.show(this.settings.zoomPane.el.clientWidth, this.settings.zoomPane.el.clientHeight);\n      }\n    }\n\n    this._handleMovement();\n  }\n\n  _hide(e) {\n    e.preventDefault();\n\n    this._lastMovement = null;\n\n    if (this.entryTimeout) {\n      clearTimeout(this.entryTimeout);\n    }\n\n    if (this.boundingBox) {\n      this.boundingBox.hide();\n    }\n\n    let onHide = this.settings.onHide;\n    if (onHide && typeof onHide === \"function\") {\n      onHide();\n    }\n\n    this.settings.zoomPane.hide();\n  }\n\n  _handleMovement(e) {\n    if (e) {\n      e.preventDefault();\n      this._lastMovement = e;\n    } else if (this._lastMovement) {\n      e = this._lastMovement;\n    } else {\n      return;\n    }\n\n    let movementX, movementY;\n\n    if (e.touches) {\n      let firstTouch = e.touches[0];\n      movementX = firstTouch.clientX;\n      movementY = firstTouch.clientY;\n    } else {\n      movementX = e.clientX;\n      movementY = e.clientY;\n    }\n\n    let el = this.settings.el;\n    let rect = el.getBoundingClientRect();\n    let offsetX = movementX - rect.left;\n    let offsetY = movementY - rect.top;\n\n    let percentageOffsetX = offsetX / this.settings.el.clientWidth;\n    let percentageOffsetY = offsetY / this.settings.el.clientHeight;\n\n    if (this.boundingBox) {\n      this.boundingBox.setPosition(percentageOffsetX, percentageOffsetY, rect);\n    }\n\n    this.settings.zoomPane.setPosition(percentageOffsetX, percentageOffsetY, rect);\n  }\n}\n"],"file":"Trigger.js"}